<div class="body" style="padding-left: 75px; margin-top: 70px;">
  <h1 class="text-center titulo tituloFuente">Consultar Configuración de Alarma</h1>
  <!-- Contenido de breadcrumb -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item" style="padding-left: 160px; font-size: 18px">
        <a href="/home">Home</a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        Consultar Configuración de Alarma
      </li>
    </ol>
  </nav>
  <div class="container mt-12">

<!-- ----------------------------Inicio de Paso a Paso-------------------------------------------- -->
<mat-vertical-stepper>
  <mat-step
    [label]="titulo1"
    [completed]="isStep1Completed"
    [ngClass]="{ collapse: isCollapsed1 }"
  >
    <ng-container contenido-paso-1>
      <div class="card-body" >
  
        <div class="row containerCard">
  
          <div class="col-12 cardFiltrado cardAnimate cardFlat cardSeparacion">
            <div>
              <div class="row">
                <div class="col-md-2 image-container">
                  <span
                    ><img
                      style="width: 102%; height: 102"
                      src="../../../assets/filtrar_central.png"
                      class="image"
                      alt="..."
                    />
                    <div class="texto">
                      <h4
                        style="
                          text-align: center;
                          color: #63ddff;
                          font-size: 18px;
                        "
                      >
                        Filtrar Central
                      </h4>
                    </div></span
                  >
                </div>                 

                <div
                class="col-md-1 vertical-line"
                style="width: 20px"
              ></div>
              <div class="col-md-2 margenFiltros">
                <div
                  class="form-outline input-group"
                  data-toggle="tooltip"
                  data-placement="top"
                  title="Buscar por Código de Central"
                >
                  <label class="search-field">
                    <mat-label
                      class="search-field label ng-tns-c97-48 ng-star-inserted"
                      >Código de Central</mat-label
                    >
                    <input
                      type="text"
                      class="form-control inputBusqueda .input-con-color-de-fondo"
                      placeholder="Ej. 1"
                      (keyup)="esFiltrar($event , 'codigo')"
                    />                             
                    <i
                      class="fas fa-search FormatoIconos"
                      style="padding-left: 20px"
                    ></i>
                  </label>
                </div>                          
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 cardFiltrado cardAnimate cardFlat cardSeparacion">
          <div class="h-100 d-flex align-items-center justify-content-center">
            <div
              class="example-button-row"
              style="display: flex; justify-content: flex-end"
            >
              <button
                mat-fab
                extended
                color="primary"
                class="btnAgregar"
                routerLink="/registrar-alarma-config"
              >
                <mat-icon>touch_app</mat-icon>
                Registrar Config. Alarmas
              </button>
            </div>
          </div>
        </div>   
     
      </div>
      <br />
      <br />

      <div class="row">
        <div class="col-12 cardFiltrado cardAnimate cardFlat">
          <!-- app.component.html -->
          <div class="table" *ngIf="dataSourceCentral">
            <table mat-table [dataSource]="dataSourceCentral" matSort #matSortCentral="matSort">

              <!-- Columnas -->
              <ng-container matColumnDef="cenNro">                                                            
                <th class="encabezado text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Cod.</th>
                <td class="table-row first-column" style="vertical-align: middle; text-align: textIzquierda"  mat-cell *matCellDef="let element">{{ element.cenNro }}</td>
              </ng-container>
      
              <ng-container matColumnDef="cenImei">
                <th class="encabezado text-center" mat-header-cell *matHeaderCellDef mat-sort-header>IMEI</th>
                <td class="table-row" style="vertical-align: middle; text-align: textIzquierda" mat-cell *matCellDef="let element">{{ element.cenImei }}</td>
              </ng-container>
      
              <ng-container matColumnDef="cenCoorX">
                <th class="encabezado text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Coordenada X</th>
                <td class="table-row" style="vertical-align: middle; text-align: textIzquierda" mat-cell *matCellDef="let element">{{ element.cenCoorX }}</td>
              </ng-container>
      
              <ng-container matColumnDef="cenCoorY">
                <th class="encabezado text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Coordenada Y</th>
                <td class="table-row" style="vertical-align: middle; text-align: textIzquierda" mat-cell *matCellDef="let element">{{ element.cenCoorY }}</td>
              </ng-container>    
      
              <!-- Columna vacia -->
              <ng-container matColumnDef="columnaVacia">
                <th class="encabezado text-center" mat-header-cell *matHeaderCellDef></th>
                <td class="table-row" class="align-center" mat-cell *matCellDef="let element"></td>
              </ng-container>
      
              <!-- Columna de acciones -->
              <ng-container matColumnDef="seleccionar">
                <th class="encabezado text-center" mat-header-cell *matHeaderCellDef>Seleccionar</th>
                <td class="table-row" class="align-center" mat-cell *matCellDef="let element">
                  <button
                    mat-button
                    (click)="seleccionarCentral(element)"
                    type="button"
                    class="btn"
                    data-bs-target="#staticBackdrop"
                    title="Seleccionar Central"
                  >
                    <img
                      src="../../../assets/seleccionar_central.png"
                      class="iconosBoton"
                      alt="..."
                    />
                  </button>
                </td>
              </ng-container>
      
              <!-- Filas -->
              <tr mat-header-row *matHeaderRowDef="displayedColumnsCentral"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsCentral; 
                let i = index" [ngClass]="{ 'fila-par': i % 2 === 0, 'fila-impar': i % 2 !== 0 }">
              </tr>      
            </table>
      
            <!-- Paginador -->
            <mat-paginator *ngIf="dataSourceCentral"
              [length]="dataSourceCentral.data.length"
              [pageSize]="pageSizeCentral"
              [pageSizeOptions]="[5, 10, 25, 100]"
              (page)="handlePageChangeCentral($event)"
              showFirstLastButtons
              #paginatorCentral
            ></mat-paginator>
      
            <div class="align-center" *ngIf="validarFiltrado() == true">
            </div>
      
            <div class="alert alert-primary text-center" role="alert" *ngIf="validarFiltrado() == false">
              No se encontraron centrales que coincidan con su búsqueda.
            </div>
      
          </div>
        </div>
      </div>

        </div>
      </ng-container>
  </mat-step>

  <mat-step
    [label]="titulo2"
    [completed]="isStep2Completed"
    [ngClass]="{ collapse: isCollapsed2 }"
    >
      <ng-container contenido-paso-2>    
        <!-- Botón ver otra central -->
        <div class="row ">
          <div
            class="example-button-row"
            style="display: flex; justify-content: flex-end"
          >
            <button
              mat-fab
              extended
              color="primary"
              class="btonNuevaConsulta"
              (click)="goToPreviousStep()"
            >
              <mat-icon>touch_app</mat-icon>
              Nueva Consulta
            </button>
          </div>
        </div>

          <br>
          <br>

          <div class="row">
            <div class="col-12 cardFiltrado cardAnimate cardFlat">
              <!-- app.component.html -->
              <div class="table" *ngIf="dataSourceAlarma">
                <table mat-table [dataSource]="dataSourceAlarma" matSort #matSortAlarma="matSort">
    
                  <!-- Columnas -->
                  <ng-container matColumnDef="cfgId">                                                            
                    <th class="encabezado text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Cod. Alm.</th>
                    <td class="table-row first-column" style="vertical-align: middle; text-align: textIzquierda"  mat-cell *matCellDef="let element">{{ element.cfgId }}</td>
                  </ng-container>
          
                  <ng-container matColumnDef="serDescripcion">
                    <th class="encabezado text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Serv.</th>
                    <td class="table-row" style="vertical-align: middle; text-align: textIzquierda" mat-cell *matCellDef="let element">{{ element.serDescripcion }}</td>
                  </ng-container>
          
                  <ng-container matColumnDef="cfgNombre">
                    <th class="encabezado text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Nomb. Alarma</th>
                    <td class="table-row" style="vertical-align: middle; text-align: textIzquierda" mat-cell *matCellDef="let element">{{ element.cfgNombre }}</td>
                  </ng-container>
          
                  <ng-container matColumnDef="cfgFechaAlta">
                    <th class="encabezado text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Fecha Alta </th>
                    <td class="table-row" style="vertical-align: middle; text-align: textIzquierda" mat-cell *matCellDef="let element">{{ element.cfgFechaAlta | date: 'yyyy-MM-dd' }}</td>
                  </ng-container>    
          
                  <ng-container matColumnDef="cfgFechaBaja">
                    <th class="encabezado text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Fecha Baja </th>
                    <td class="table-row" style="vertical-align: middle; text-align: textIzquierda" mat-cell *matCellDef="let element">{{ element.cfgFechaBaja | date: 'yyyy-MM-dd' }}</td>
                  </ng-container>    

                  <ng-container matColumnDef="cfgValorSuperiorA">
                    <th class="encabezado text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Lím. Superior </th>
                    <td class="table-row" style="vertical-align: middle; text-align: textIzquierda" mat-cell *matCellDef="let element">{{ element.cfgValorSuperiorA }}</td>
                  </ng-container>    

                  <ng-container matColumnDef="cfgValorInferiorA">
                    <th class="encabezado text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Lím. Inferior </th>
                    <td class="table-row" style="vertical-align: middle; text-align: textIzquierda" mat-cell *matCellDef="let element">{{ element.cfgValorInferiorA }}</td>
                  </ng-container>    

                  <ng-container matColumnDef="cfgObservacion">
                    <th class="encabezado text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Observación </th>
                    <td class="table-row" style="vertical-align: middle; text-align: textIzquierda" mat-cell *matCellDef="let element">{{ element.cfgObservacion }}</td>
                  </ng-container>   
                  
                  <!-- Columna de acciones -->
                  <ng-container matColumnDef="modEstado">
                    <th class="encabezado text-center" mat-header-cell *matHeaderCellDef>Mod. Estado</th>
                    <td class="table-row align-center" mat-cell *matCellDef="let element">
                      <button
                        *ngIf="element.cfgFechaBaja !== null"
                        type="button"
                        class="btn"
                        mat-button
                        (click)="ModificarEstadoAlarma(element, 0, 'Disponible')"
                        title="Cambiar Estado Alarma a Disponible"
                      >
                        <img src="../../../assets/2_disponibleAlarma.png" class="iconosBoton" alt="..." />
                      </button>
                      <button
                        *ngIf="element.cfgFechaBaja === null"
                        type="button"
                        class="btn"
                        mat-button
                        (click)="ModificarEstadoAlarma(element, 1, 'Baja')"
                        title="Cambiar Estado Alarma a Baja"
                      >
                        <img src="../../../assets/2_remove.png" class="iconosBoton" alt="..." />
                      </button>
                    </td>
                  </ng-container>

          
                  <!-- Columna de acciones -->
                  <ng-container matColumnDef="seleccionar">
                    <th class="encabezado text-center" mat-header-cell *matHeaderCellDef>Modificar Alarma</th>
                    <td class="table-row" class="align-center" mat-cell *matCellDef="let element">
                      <button
                        type="button"
                        class="btn"
                        data-bs-target="#staticBackdrop"  
                        mat-button
                        (click)="seleccionarAlarma(element)"
                        title="Modificar Alarma"
                      >
                        <img
                          src="../../../assets/ver_mas.png"
                          class="iconosBoton"
                          alt="..."
                        />
                      </button>    
                    </td> 
                  </ng-container>
    
          
                  <!-- Filas -->
                  <tr mat-header-row *matHeaderRowDef="displayedColumnsAlarma"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumnsAlarma; 
                    let i = index" [ngClass]="{ 'fila-par': i % 2 === 0, 'fila-impar': i % 2 !== 0 }">
                  </tr>      
                </table>
          
                <!-- Paginador -->
                <mat-paginator *ngIf="dataSourceAlarma"
                  [length]="dataSourceAlarma.data.length"
                  [pageSize]="pageSizeAlarma"
                  [pageSizeOptions]="[5, 10, 25, 100]"
                  (page)="handlePageChangeAlarma($event)"
                  showFirstLastButtons
                  #paginatorAlarma
                ></mat-paginator>
          
                <div class="align-center" *ngIf="validarFiltradoAlarma() == true">
                </div>
          
                <div class="alert alert-primary text-center" role="alert" *ngIf="validarFiltradoAlarma() == false">
                  No se encontraron alarmas que coincidan con su búsqueda.
                </div>
          
              </div>
            </div>
          </div>

      </ng-container>
  </mat-step>
    
  <mat-step
  [label]="titulo3"
  [completed]="isStep3Completed"
  [ngClass]="{ collapse: isCollapsed3 }"
  >
    <ng-container contenido-paso-3>    

    <!-- Botón ver otra alarma -->
    <div class="row ">
      <div
        class="example-button-row"
        style="display: flex; justify-content: flex-end"
      >
        <button
          mat-fab
          extended
          color="primary"
          class="btnAgregar"
          (click)="goToPreviousStep()"
        >
          <mat-icon>touch_app</mat-icon>
          Nueva Consulta
        </button>
      </div>
    </div>

    <div class="card cardFiltrado cardAnimate cardFlat">
      <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0 tituloCard">Modificar Alarma</h4>
          <img
            src="../../../assets/config_alarma.png"
            class="image"
            style="width: 5%; height: 5%; padding-right: 5px"
            alt="..."
          />
        </div>
      </div>
      
      <br/>

      <form [formGroup]="formModificar">
        <div class="container">
          <div class="row">
            <div class="col-sm-9" style="justify-content: right">
              <div class="row justify-content-center">
                <div class="col-50 col-sm-50">
                  <div class="row">
                    <div class="col-md-6">

                      <div class="form-outline input-group mb-3">
                        <mat-form-field
                          appearance="fill"
                          class="example-full-width form-outline input-group"
                        >
                          <mat-label>Número de Central</mat-label>
                          <input
                            type="text"
                            style="padding-left: 20px"
                            matInput
                            id="nroCentral"
                            value="nroCentral"
                            formControlName="nroCentral"
                            required
                            readonly
                          />
                          <mat-icon class="edit" matSuffix
                            >edit_off</mat-icon
                          >
                        </mat-form-field>                        
                      </div>
                      
                      <div class="form-outline input-group mb-3">
                        <mat-form-field
                          appearance="fill"
                          class="example-full-width form-outline input-group"
                        >
                          <mat-label>Nombre de Alarma</mat-label>
                          <input
                            type="text"
                            style="padding-left: 20px"
                            matInput
                            id="nombreAlarma"
                            value="nombreAlarma"
                            formControlName="nombreAlarma"
                            required
                          />
                          <mat-icon class="edit" matSuffix
                            >edit</mat-icon
                          >
                        </mat-form-field>
                        <mat-error
                          *ngIf="
                          nombreAlarma?.invalid &&
                            (nombreAlarma?.dirty ||
                            nombreAlarma?.touched)
                          "
                          class="text-danger"
                        >
                          <mat-error
                            class="error"
                            *ngIf="nombreAlarma?.errors?.['required']"
                          >
                            Debe ingresar un nombre de alarma.
                          </mat-error>
                          <mat-error
                            class="error"
                            *ngIf="nombreAlarma?.errors?.['pattern']"
                          >
                            No debe contener caracteres especiales ni tener más de 50 carácteres.                                                         
                          </mat-error>
                        </mat-error>
                      </div>

                      <div class="form-outline input-group mb-3">
                        <mat-form-field
                          style="width: 525px"
                          >
                          <mat-label>Seleccione un Servicio</mat-label>
                          <mat-select 
                            style="padding-left: 30px"                              
                            placeholder="Seleccionar un Servicio" 
                            required
                            id="nombreServicio"
                            formControlName="nombreServicio"
                            >
                            <mat-option *ngFor="let servicio of ServiciosCentral" [value]="servicio.serId">
                              {{servicio.serDescripcion}}
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                        <mat-error
                          *ngIf="
                          nombreServicio?.invalid &&
                            (nombreServicio?.dirty ||
                            nombreServicio?.touched)
                          "
                          class="text-danger"
                        >
                          <mat-error
                            class="error"
                            *ngIf="nombreServicio?.errors?.['required']"
                          >
                            Debe seleccionar un servicio.
                          </mat-error>
                        </mat-error>
                      </div>

                      <div class="form-outline input-group mb-3">
                        <mat-form-field
                          appearance="fill"
                          class="example-full-width form-outline input-group"
                        >
                          <mat-label>Límite Superior</mat-label>
                          <input
                            type="text"
                            style="padding-left: 20px"
                            matInput
                            id="cfgValorSuperiorA"
                            value="cfgValorSuperiorA"
                            formControlName="cfgValorSuperiorA"
                            required
                          />
                          <mat-icon class="edit" matSuffix
                            >edit</mat-icon
                          >
                        </mat-form-field>
                        <mat-error
                          *ngIf="
                          cfgValorSuperiorA?.invalid &&
                            (cfgValorSuperiorA?.dirty ||
                            cfgValorSuperiorA?.touched)
                          "
                          class="text-danger"
                        >
                          <mat-error
                            class="error"
                            *ngIf="cfgValorSuperiorA?.errors?.['required']"
                          >
                            Debe ingresar un Límite Superior.
                          </mat-error>
                          <mat-error
                            class="error"
                            *ngIf="cfgValorSuperiorA?.errors?.['pattern']"
                          >
                          Debe contener números con un máximo de dos decimales y no debe incluir caracteres especiales.
                          </mat-error>
                        </mat-error>
                      </div>

                      <div class="form-outline input-group mb-3">
                        <mat-form-field
                          appearance="fill"
                          class="example-full-width form-outline input-group"
                        >
                          <mat-label>Límite Inferior</mat-label>
                          <input
                            type="text"
                            style="padding-left: 20px"
                            matInput
                            id="cfgValorInferiorA"
                            value="cfgValorInferiorA"
                            formControlName="cfgValorInferiorA"
                            required
                          />
                          <mat-icon class="edit" matSuffix
                            >edit</mat-icon
                          >
                        </mat-form-field>
                        <mat-error
                          *ngIf="
                          cfgValorInferiorA?.invalid &&
                            (cfgValorInferiorA?.dirty ||
                            cfgValorInferiorA?.touched)
                          "
                          class="text-danger"
                        >
                          <mat-error
                            class="error"
                            *ngIf="cfgValorInferiorA?.errors?.['required']"
                          >
                          Debe ingresar un Límite Inferior.
                        </mat-error>
                        <mat-error
                            class="error"
                            *ngIf="cfgValorInferiorA?.errors?.['pattern']"
                          >
                          Debe contener números con un máximo de dos decimales y no debe incluir caracteres especiales.
                          </mat-error>
                        </mat-error>
                      </div>
                      
                      <div class="form-outline input-group mb-3">
                        <mat-form-field
                          appearance="fill"
                          class="example-full-width form-outline input-group"
                        >
                          <mat-label>Observación</mat-label>
                          <input
                            type="text"
                            style="padding-left: 20px"
                            matInput
                            id="cfgObservacion"
                            value="cfgObservacion"
                            formControlName="cfgObservacion"                    
                          />
                          <mat-icon class="edit" matSuffix
                            >edit</mat-icon
                          >
                        </mat-form-field>
                        <mat-error
                          *ngIf="
                          cfgObservacion?.invalid &&
                            (cfgObservacion?.dirty ||
                            cfgObservacion?.touched)
                          "
                          class="text-danger"
                        >
                        <mat-error
                            class="error"
                            *ngIf="cfgObservacion?.errors?.['pattern']"
                          >
                          No debe contener caracteres especiales ni tener más de 100 carácteres.
                          </mat-error>
                        </mat-error>
                      </div>                    
                      
                      <br>
                      <div
                        class="col-12 text-center"
                        style="display: flex; justify-content: center"
                      >
                        <div class="modal-footer example-button-row">
                          <button
                            mat-fab
                            extended
                            color="primary"
                            type="submit"
                            id="btnModificar"
                            class="btn btnModificar"
                            data-bs-target="#staticBackdrop"
                            (click)="modificarAlarmaConfig()"
                          >
                            Modificar Alarma
                          </button>
                        </div>
                      </div> 

                    </div>
                  </div>
              

                </div>
              </div>
            </div>

            <!-------------------- Ir a Registrar Alarma: .col-sm-4 ---------------------------------->
            <div
            class="col-sm-3"
            style="display: flex; justify-content: left"
          >
            <div class="col-md-2 image-container">
              <span
                ><img
                  style="
                    width: 100%;
                    height: 100%;
                    margin-bottom: 100px;
                  "
                  src="../../../assets/alarm.png"
                  class="image"
                  alt="..."
                />
              
              <!-- Botón Registrar Alarma -->
              <div class="row">
                <div
                  class="example-button-row"
                  style="display: flex; justify-content: flex-end"
                >
                  <button
                    mat-fab
                    extended
                    color="primary"
                    class="btnAgregar"
                    routerLink="/registrar-alarma-config"
                    >
                    <mat-icon>touch_app</mat-icon>
                    Registrar Nueva Alarma
                  </button>
                </div>
              </div>
              </span>
            </div>
          </div>


          </div>
        </div>
      </form>

    </div>

    <br>
    <br>

    </ng-container>
  </mat-step>

  </mat-vertical-stepper>
</div>  
<br />
</div>